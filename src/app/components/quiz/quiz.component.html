<div class="quiz-container">
    <header class="page-header">
        <h1>Desafio AdvPL & TLPP</h1>
        <p>Escolha um t√≥pico e teste seus conhecimentos.</p>
    </header>

    <!-- 1. T√ìPICOS (MENU PRINCIPAL) -->
    <div class="topics-grid" *ngIf="!selectedTopic">
        <div class="topic-card glass-card" *ngFor="let topic of topics" (click)="selectTopic(topic)">
            <div class="topic-icon">{{ topic.icon }}</div>
            <div class="topic-info">
                <h2>{{ topic.title }}</h2>
                <p>{{ topic.description }}</p>
            </div>
            <div class="topic-badge">{{ topic.quizzes.length }} Quizzes</div>
        </div>
    </div>

    <!-- 2. LISTA DE QUIZZES DO T√ìPICO -->
    <div class="quizzes-grid" *ngIf="selectedTopic && !selectedQuiz">
        <button class="btn-back-top" (click)="goBackToTopics()">‚Üê Voltar aos T√≥picos</button>
        <h2 class="section-title">Quizzes de {{ selectedTopic.title }}</h2>

        <div class="quiz-selection-card glass-card" *ngFor="let quiz of selectedTopic.quizzes"
            (click)="selectQuiz(quiz)">
            <div class="quiz-level-badge" [ngClass]="{
                'iniciante': quiz.level === 'Iniciante',
                'medio': quiz.level === 'Intermedi√°rio',
                'avancado': quiz.level === 'Avan√ßado'
            }">{{ quiz.level }}</div>
            <h3>{{ quiz.title }}</h3>
            <p>{{ quiz.questions.length }} Quest√µes</p>
            <button class="btn-start">Iniciar</button>
        </div>
    </div>

    <!-- 3. √ÅREA DE JOGO (PERGUNTAS) -->
    <div class="quiz-active" *ngIf="selectedQuiz">

        <button class="btn-back" (click)="goBackToQuizzes()" *ngIf="!showResults">‚Üê Cancelar Quiz</button>

        <div class="quiz-content" *ngIf="!showResults">
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="((currentIndex + 1) / totalQuestions) * 100"></div>
            </div>

            <div class="question-card glass-card">
                <div class="question-header">
                    <span class="q-number">Quest√£o {{ currentIndex + 1 }}/{{ totalQuestions }}</span>
                    <span class="score-badge">Pontos: {{ score }}</span>
                </div>

                <h2 class="question-text">{{ currentQuestion.question }}</h2>

                <div class="options-list">
                    <button *ngFor="let option of currentQuestion.options; let i = index" class="option-btn"
                        [class.selected]="selectedOption === i"
                        [class.correct]="isAnswerChecked && i === currentQuestion.correctIndex"
                        [class.wrong]="isAnswerChecked && selectedOption === i && i !== currentQuestion.correctIndex"
                        [disabled]="isAnswerChecked" (click)="selectOption(i)">
                        <span class="opt-label">{{ ['A', 'B', 'C', 'D'][i] }}</span>
                        {{ option }}
                        <span class="result-icon" *ngIf="isAnswerChecked">
                            <ng-container *ngIf="i === currentQuestion.correctIndex">‚úì</ng-container>
                            <ng-container
                                *ngIf="selectedOption === i && i !== currentQuestion.correctIndex">‚úï</ng-container>
                        </span>
                    </button>
                </div>

                <div class="actions-area">
                    <div class="feedback-box" *ngIf="isAnswerChecked"
                        [class.success]="selectedOption === currentQuestion.correctIndex"
                        [class.error]="selectedOption !== currentQuestion.correctIndex">
                        <p class="feedback-title">
                            {{ selectedOption === currentQuestion.correctIndex ? 'Correto!' : 'Incorreto.' }}
                        </p>
                        <p class="explanation">{{ currentQuestion.explanation }}</p>
                    </div>

                    <div class="btn-wrapper">
                        <button *ngIf="!isAnswerChecked" class="btn-primary" [disabled]="selectedOption === null"
                            (click)="checkAnswer()">Confirmar Resposta</button>
                        <button *ngIf="isAnswerChecked" class="btn-primary" (click)="nextQuestion()">
                            {{ currentIndex === totalQuestions - 1 ? 'Ver Resultado' : 'Pr√≥xima Quest√£o' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TELA DE RESULTADOS -->
        <div class="results-card glass-card" *ngIf="showResults">
            <div class="result-header">
                <div class="trophy">üèÜ</div>
                <h2>{{ selectedQuiz.title }} - Conclu√≠do!</h2>
            </div>

            <div class="score-display">
                <span class="big-score">{{ score }}</span>
                <span class="total">de {{ totalQuestions }}</span>
            </div>

            <p class="performance-msg" *ngIf="score === totalQuestions">Perfeito! Voc√™ √© um mestre neste assunto!</p>
            <p class="performance-msg" *ngIf="score < totalQuestions && score > totalQuestions / 2">Muito bom! Continue
                estudando.</p>
            <p class="performance-msg" *ngIf="score <= totalQuestions / 2">Precisa revisar. Tente novamente!</p>

            <div class="result-actions">
                <button class="btn-primary" (click)="restartQuiz()">Tentar Novamente</button>
                <button class="btn-secondary" (click)="goBackToQuizzes()">Escolher Outro Quiz</button>
                <button class="btn-text" (click)="goBackToTopics()">Menu Principal</button>
            </div>
        </div>
    </div>
</div>